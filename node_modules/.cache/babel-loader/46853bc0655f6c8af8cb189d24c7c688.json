{"ast":null,"code":"import _toConsumableArray from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import MarvelService from'../../services/MarvelService';import{Component}from'react';import Spinner from'../spinner/Spinner';import ErrorMessage from'../errorMessage/ErrorMessage';import ImgObjFit from'../blocks/imgObjectFit';import'./charList.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CharList=/*#__PURE__*/function(_Component){_inherits(CharList,_Component);var _super=_createSuper(CharList);function CharList(){var _this;_classCallCheck(this,CharList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:1541,charEnded:false};_this.marvelService=new MarvelService();_this.onRequest=function(offset){_this.onCharListLoading();_this.marvelService.getAllCharacters(offset).then(_this.onCharListLoaded).catch(_this.onError);};_this.onCharListLoading=function(){_this.setState({newItemLoading:true});};_this.onCharListLoaded=function(newCharList){var ended=false;if(newCharList.length<9){ended=true;}_this.setState(function(_ref){var charList=_ref.charList,offset=_ref.offset;return{charList:[].concat(_toConsumableArray(charList),_toConsumableArray(newCharList)),loading:false,newItemLoading:false,offset:offset+9,charEnded:ended};});};_this.onError=function(){_this.setState({error:true,loading:false});};return _this;}_createClass(CharList,[{key:\"componentDidMount\",value:function componentDidMount(){this.onRequest();}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,charList=_this$state.charList,loading=_this$state.loading,error=_this$state.error,offset=_this$state.offset,charEnded=_this$state.charEnded,newItemLoading=_this$state.newItemLoading;var spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;var errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;var content=!(loading||error)?/*#__PURE__*/_jsx(Items,{onCharSelected:this.props.onCharSelected,charlist:charList}):null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[/*#__PURE__*/_jsxs(\"ul\",{className:\"char__grid\",children:[errorMessage,spinner,content]}),/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",onClick:function onClick(){return _this2.onRequest(offset);},disabled:newItemLoading,style:{'display':charEnded?'none':'block'},children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}]);return CharList;}(Component);var Items=/*#__PURE__*/function(_Component2){_inherits(Items,_Component2);var _super2=_createSuper(Items);function Items(){var _this3;_classCallCheck(this,Items);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this3=_super2.call.apply(_super2,[this].concat(args));_this3.state={id:null,selected:false,isFocused:false};_this3.onItemSelected=function(id,elem){_this3.setState({selected:true,isFocused:true,id:id});};_this3.itemRefs=[];_this3.setRef=function(ref){_this3.itemRefs.push(ref);};_this3.focusOnItem=function(id){console.log(id,'focus');_this3.itemRefs.forEach(function(item){return item.classList.remove('char__item_selected');});_this3.itemRefs[id].classList.add('char__item_selected');_this3.itemRefs[id].focus();};return _this3;}_createClass(Items,[{key:\"render\",value:function render(){var _this4=this;var _this$props=this.props,charlist=_this$props.charlist,onCharSelected=_this$props.onCharSelected;return charlist.map(function(item,i){var id=item.id,name=item.name;var classNames='char__item';if(id===_this4.state.id&&_this4.state.isFocused){classNames+=' char__item_selected';}return/*#__PURE__*/_jsxs(\"li\",{className:classNames,ref:_this4.setRef,onClick:function onClick(){onCharSelected(id);_this4.onItemSelected(id);},tabIndex:\"0\",onKeyPress:function onKeyPress(e){if(e.key===' '||e.key===\"Enter\"){_this4.props.onCharSelected(id);_this4.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(ImgObjFit,{char:item,alt:name}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:name})]},id);});}}]);return Items;}(Component);export default CharList;","map":{"version":3,"sources":["C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/src/components/charList/CharList.js"],"names":["MarvelService","Component","Spinner","ErrorMessage","ImgObjFit","CharList","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newCharList","ended","length","spinner","errorMessage","content","props","onCharSelected","Items","id","selected","isFocused","onItemSelected","elem","itemRefs","setRef","ref","push","focusOnItem","console","log","forEach","item","classList","remove","add","focus","charlist","map","i","name","classNames","e","key"],"mappings":"+5BAAA,MAAOA,CAAAA,aAAP,KAA0B,8BAA1B,CACA,OAASC,SAAT,KAA0B,OAA1B,CAEA,MAAOC,CAAAA,OAAP,KAAoB,oBAApB,CACA,MAAOC,CAAAA,YAAP,KAAyB,8BAAzB,CACA,MAAOC,CAAAA,SAAP,KAAsB,wBAAtB,CACA,MAAO,iBAAP,C,2FAGMC,CAAAA,Q,mUAEFC,K,CAAQ,CACJC,QAAQ,CAAE,EADN,CAEJC,OAAO,CAAE,IAFL,CAGJC,KAAK,CAAE,KAHH,CAIJC,cAAc,CAAE,KAJZ,CAKJC,MAAM,CAAE,IALJ,CAMJC,SAAS,CAAE,KANP,C,OASRC,a,CAAgB,GAAIb,CAAAA,aAAJ,E,OAMhBc,S,CAAY,SAACH,MAAD,CAAY,CACpB,MAAKI,iBAAL,GACA,MAAKF,aAAL,CAAmBG,gBAAnB,CAAoCL,MAApC,EACKM,IADL,CACU,MAAKC,gBADf,EAEKC,KAFL,CAEW,MAAKC,OAFhB,EAGH,C,OAEDL,iB,CAAoB,UAAM,CACtB,MAAKM,QAAL,CAAc,CACVX,cAAc,CAAE,IADN,CAAd,EAGH,C,OAEDQ,gB,CAAmB,SAACI,WAAD,CAAiB,CAChC,GAAIC,CAAAA,KAAK,CAAG,KAAZ,CACA,GAAID,WAAW,CAACE,MAAZ,CAAqB,CAAzB,CAA4B,CACxBD,KAAK,CAAG,IAAR,CACH,CAED,MAAKF,QAAL,CAAc,kBAAEd,CAAAA,QAAF,MAAEA,QAAF,CAAYI,MAAZ,MAAYA,MAAZ,OAAyB,CAC/BJ,QAAQ,8BAAMA,QAAN,qBAAmBe,WAAnB,EADuB,CAE/Bd,OAAO,CAAE,KAFsB,CAG/BE,cAAc,CAAE,KAHe,CAI/BC,MAAM,CAAGA,MAAM,CAAG,CAJa,CAK/BC,SAAS,CAAEW,KALoB,CAAzB,EAAd,EAOH,C,OAEDH,O,CAAU,UAAM,CACZ,MAAKC,QAAL,CAAc,CACVZ,KAAK,CAAE,IADG,CAEVD,OAAO,CAAE,KAFC,CAAd,EAIH,C,qEArCD,4BAAoB,CAChB,KAAKM,SAAL,GACH,C,sBAqCD,iBAAS,iBACL,gBAAqE,KAAKR,KAA1E,CAAOC,QAAP,aAAOA,QAAP,CAAiBC,OAAjB,aAAiBA,OAAjB,CAA0BC,KAA1B,aAA0BA,KAA1B,CAAiCE,MAAjC,aAAiCA,MAAjC,CAAwCC,SAAxC,aAAwCA,SAAxC,CAAmDF,cAAnD,aAAmDA,cAAnD,CAEA,GAAMe,CAAAA,OAAO,CAAGjB,OAAO,cAAG,KAAC,OAAD,IAAH,CAAgB,IAAvC,CACA,GAAMkB,CAAAA,YAAY,CAAGjB,KAAK,cAAG,KAAC,YAAD,IAAH,CAAqB,IAA/C,CACA,GAAMkB,CAAAA,OAAO,CAAG,EAAEnB,OAAO,EAAIC,KAAb,eAAsB,KAAC,KAAD,EAAO,cAAc,CAAE,KAAKmB,KAAL,CAAWC,cAAlC,CAAkD,QAAQ,CAAEtB,QAA5D,EAAtB,CAAgG,IAAhH,CAEA,mBACI,aAAK,SAAS,CAAC,YAAf,wBACI,YAAI,SAAS,CAAC,YAAd,WACKmB,YADL,CAEKD,OAFL,CAGKE,OAHL,GADJ,cAMI,eACI,SAAS,CAAC,kCADd,CAEI,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACb,SAAL,CAAeH,MAAf,CAAN,EAFb,CAGI,QAAQ,CAAED,cAHd,CAII,KAAK,CAAE,CAAC,UAAWE,SAAS,CAAG,MAAH,CAAY,OAAjC,CAJX,uBAKI,YAAK,SAAS,CAAC,OAAf,uBALJ,EANJ,GADJ,CAgBH,C,sBA3EkBX,S,KA8EjB6B,CAAAA,K,uUACFxB,K,CAAQ,CACJyB,EAAE,CAAE,IADA,CAEJC,QAAQ,CAAE,KAFN,CAGJC,SAAS,CAAE,KAHP,C,QAORC,c,CAAiB,SAACH,EAAD,CAAKI,IAAL,CAAc,CAC3B,OAAKd,QAAL,CAAc,CACVW,QAAQ,CAAE,IADA,CAEVC,SAAS,CAAE,IAFD,CAGVF,EAAE,CAAEA,EAHM,CAAd,EAMH,C,QAEDK,Q,CAAW,E,QAEXC,M,CAAS,SAACC,GAAD,CAAS,CACd,OAAKF,QAAL,CAAcG,IAAd,CAAmBD,GAAnB,EACH,C,QAEDE,W,CAAc,SAACT,EAAD,CAAQ,CAClBU,OAAO,CAACC,GAAR,CAAYX,EAAZ,CAAgB,OAAhB,EACA,OAAKK,QAAL,CAAcO,OAAd,CAAsB,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAACC,SAAL,CAAeC,MAAf,CAAsB,qBAAtB,CAAJ,EAA1B,EACA,OAAKV,QAAL,CAAcL,EAAd,EAAkBc,SAAlB,CAA4BE,GAA5B,CAAgC,qBAAhC,EACA,OAAKX,QAAL,CAAcL,EAAd,EAAkBiB,KAAlB,GACH,C,wDAED,iBAAU,iBAEN,gBAAmC,KAAKpB,KAAxC,CAAOqB,QAAP,aAAOA,QAAP,CAAiBpB,cAAjB,aAAiBA,cAAjB,CAEA,MACIoB,CAAAA,QAAQ,CAACC,GAAT,CAAa,SAACN,IAAD,CAAOO,CAAP,CAAa,CACtB,GAAOpB,CAAAA,EAAP,CAAmBa,IAAnB,CAAOb,EAAP,CAAWqB,IAAX,CAAmBR,IAAnB,CAAWQ,IAAX,CAEA,GAAIC,CAAAA,UAAU,CAAG,YAAjB,CACA,GAAItB,EAAE,GAAK,MAAI,CAACzB,KAAL,CAAWyB,EAAlB,EAAwB,MAAI,CAACzB,KAAL,CAAW2B,SAAvC,CAAkD,CAC9CoB,UAAU,EAAI,sBAAd,CACH,CAED,mBACI,YAAI,SAAS,CAAEA,UAAf,CAEI,GAAG,CAAE,MAAI,CAAChB,MAFd,CAGI,OAAO,CAAE,kBAAM,CACXR,cAAc,CAACE,EAAD,CAAd,CACA,MAAI,CAACG,cAAL,CAAoBH,EAApB,EACH,CANL,CAOI,QAAQ,CAAC,GAPb,CAQI,UAAU,CAAE,oBAACuB,CAAD,CAAO,CACf,GAAIA,CAAC,CAACC,GAAF,GAAU,GAAV,EAAiBD,CAAC,CAACC,GAAF,GAAU,OAA/B,CAAwC,CACpC,MAAI,CAAC3B,KAAL,CAAWC,cAAX,CAA0BE,EAA1B,EACA,MAAI,CAACS,WAAL,CAAiBW,CAAjB,EACH,CAAC,CAZV,wBAaI,KAAC,SAAD,EAAW,IAAI,CAAEP,IAAjB,CAAuB,GAAG,CAAEQ,IAA5B,EAbJ,cAcI,YAAK,SAAS,CAAC,YAAf,UAA6BA,IAA7B,EAdJ,GACSrB,EADT,CADJ,CAkBH,CA1BD,CADJ,CA6BH,C,mBA/De9B,S,EAkEpB,cAAeI,CAAAA,QAAf","sourcesContent":["import MarvelService from '../../services/MarvelService';\r\nimport { Component } from 'react';\r\n\r\nimport Spinner from '../spinner/Spinner';\r\nimport ErrorMessage from '../errorMessage/ErrorMessage';\r\nimport ImgObjFit from '../blocks/imgObjectFit';\r\nimport './charList.scss';\r\n\r\n\r\nclass CharList extends Component {\r\n\r\n    state = {\r\n        charList: [],\r\n        loading: true,\r\n        error: false,\r\n        newItemLoading: false,\r\n        offset: 1541,\r\n        charEnded: false\r\n    }\r\n\r\n    marvelService = new MarvelService();\r\n\r\n    componentDidMount() {\r\n        this.onRequest();\r\n    }\r\n\r\n    onRequest = (offset) => {\r\n        this.onCharListLoading();\r\n        this.marvelService.getAllCharacters(offset)\r\n            .then(this.onCharListLoaded)\r\n            .catch(this.onError);\r\n    }\r\n\r\n    onCharListLoading = () => {\r\n        this.setState({\r\n            newItemLoading: true\r\n        })\r\n    }\r\n\r\n    onCharListLoaded = (newCharList) => {\r\n        let ended = false;\r\n        if (newCharList.length < 9) {\r\n            ended = true\r\n        }\r\n\r\n        this.setState(({charList, offset}) => ({\r\n                charList: [...charList, ...newCharList],\r\n                loading: false,\r\n                newItemLoading: false,\r\n                offset:  offset + 9,\r\n                charEnded: ended\r\n            }));\r\n    }\r\n        \r\n    onError = () => {\r\n        this.setState({\r\n            error: true,\r\n            loading: false\r\n        })\r\n    }\r\n   \r\n    render() {\r\n        const {charList, loading, error, offset,charEnded, newItemLoading} = this.state;\r\n\r\n        const spinner = loading ? <Spinner/> : null;\r\n        const errorMessage = error ? <ErrorMessage/> : null;\r\n        const content = !(loading || error) ? <Items onCharSelected={this.props.onCharSelected} charlist={charList}/> : null;\r\n\r\n        return (\r\n            <div className=\"char__list\">\r\n                <ul className=\"char__grid\">\r\n                    {errorMessage}\r\n                    {spinner}\r\n                    {content}\r\n                </ul>\r\n                <button \r\n                    className=\"button button__main button__long\"\r\n                    onClick={() => this.onRequest(offset)}\r\n                    disabled={newItemLoading}\r\n                    style={{'display': charEnded ? 'none' : 'block'}}>\r\n                    <div className=\"inner\">load more</div>\r\n                </button>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nclass Items extends Component {\r\n    state = {\r\n        id: null,\r\n        selected: false,\r\n        isFocused: false\r\n    }\r\n\r\n\r\n    onItemSelected = (id, elem) => {\r\n        this.setState({\r\n            selected: true,\r\n            isFocused: true,\r\n            id: id\r\n        })\r\n\r\n    }\r\n\r\n    itemRefs = [];\r\n\r\n    setRef = (ref) => {\r\n        this.itemRefs.push(ref);\r\n    }\r\n\r\n    focusOnItem = (id) => {\r\n        console.log(id, 'focus');\r\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'));\r\n        this.itemRefs[id].classList.add('char__item_selected');\r\n        this.itemRefs[id].focus();\r\n    }\r\n\r\n    render () {\r\n       \r\n        const {charlist, onCharSelected} = this.props;\r\n\r\n        return (\r\n            charlist.map((item, i) => {\r\n                const {id, name} = item;\r\n\r\n                let classNames = 'char__item';\r\n                if (id === this.state.id && this.state.isFocused) {\r\n                    classNames += ' char__item_selected';\r\n                }\r\n                \r\n                return (\r\n                    <li className={classNames}\r\n                        key={id}\r\n                        ref={this.setRef}\r\n                        onClick={() => {\r\n                            onCharSelected(id);\r\n                            this.onItemSelected(id);\r\n                        }}\r\n                        tabIndex='0'\r\n                        onKeyPress={(e) => { \r\n                            if (e.key === ' ' || e.key === \"Enter\") {\r\n                                this.props.onCharSelected(id);\r\n                                this.focusOnItem(i);\r\n                            }}}>\r\n                        <ImgObjFit char={item} alt={name}/>\r\n                        <div className=\"char__name\">{name}</div>\r\n                    </li>\r\n                )\r\n            })\r\n        )\r\n    }\r\n}\r\n\r\nexport default CharList;"]},"metadata":{},"sourceType":"module"}