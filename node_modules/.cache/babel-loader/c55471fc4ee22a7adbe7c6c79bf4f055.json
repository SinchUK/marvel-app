{"ast":null,"code":"var _jsxFileName = \"C:\\\\DiskA\\\\Frontend\\\\Udemy2021Tasks\\\\Projects\\\\React\\\\marvel\\\\marvel-app\\\\src\\\\components\\\\charList\\\\CharList.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport MarvelService from '../../services/MarvelService';\nimport { useState, useEffect, useRef } from 'react';\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../errorMessage/ErrorMessage';\nimport ImgObjFit from '../blocks/imgObjectFit';\nimport './charList.scss';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst CharList = () => {\n  _s();\n\n  const [charList, setCharList] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [newItemLoading, setNewItemLoading] = useState(false);\n  const [offset, setOffset] = useState(1541);\n  const [charEnded, setCharEnded] = useState(false);\n  const marvelService = new MarvelService();\n  useEffect(() => {\n    onRequest();\n  }, []);\n\n  const onRequest = offset => {\n    onCharListLoading();\n    marvelService.getAllCharacters(offset).then(onCharListLoaded).catch(onError);\n  };\n\n  const onCharListLoading = () => {\n    setNewItemLoading(true);\n  };\n\n  const onCharListLoaded = newCharList => {\n    let ended = false;\n\n    if (newCharList.length < 9) {\n      ended = true;\n    }\n\n    setCharList(charlist => [...charList, ...newCharList]);\n    setLoading(loading => false);\n    setNewItemLoading(newItemLoading => false);\n    setOffset(offset => offset + 9);\n    setCharEnded(charEnded => ended);\n  };\n\n  const onError = () => {\n    setError(true);\n    setLoading(loading => false);\n  };\n\n  const spinner = loading ? /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 31\n  }, this) : null;\n  const errorMessage = error ? /*#__PURE__*/_jsxDEV(ErrorMessage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 34\n  }, this) : null;\n  const content = !(loading || error) ? /*#__PURE__*/_jsxDEV(Items, {\n    onCharSelected: props.onCharSelected,\n    charlist: charList\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 43\n  }, this) : null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"char__list\",\n    children: [/*#__PURE__*/_jsxDEV(\"ul\", {\n      className: \"char__grid\",\n      children: [errorMessage, spinner, content]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"button button__main button__long\",\n      onClick: () => this.onRequest(offset),\n      disabled: newItemLoading,\n      style: {\n        'display': charEnded ? 'none' : 'block'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"inner\",\n        children: \"load more\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 61,\n    columnNumber: 9\n  }, this);\n};\n\n_s(CharList, \"hF6B03XbxtYzgWr2MTUdwuYSl9s=\");\n\n_c = CharList;\n\nconst Items = props => {\n  _s2();\n\n  const [id, setId] = useState(null);\n  const [selected, setSelect] = useState(false);\n  const [isFocused, setFocus] = useState(false);\n\n  const onItemSelected = (id, elem) => {\n    this.setState({\n      selected: true,\n      isFocused: true,\n      id: id\n    });\n    setId(id);\n    setSelect(true);\n    setFocus(true);\n  };\n\n  const itemRefs = useRef([]);\n\n  const focusOnItem = id => {\n    console.log(id, 'focus');\n    itemRefs.current.forEach(item => item.classList.remove('char__item_selected'));\n    itemRefs.current[id].classList.add('char__item_selected');\n    itemRefs.current[id].focus();\n  }; // const {charlist, onCharSelected} = this.props;\n\n\n  return charlist.map((item, i) => {\n    const {\n      id,\n      name\n    } = item;\n    let classNames = 'char__item';\n\n    if (id === this.state.id && this.state.isFocused) {\n      classNames += ' char__item_selected';\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"li\", {\n      className: classNames,\n      ref: el => itemRefs.current[i] = el,\n      onClick: () => {\n        onCharSelected(id);\n        this.onItemSelected(id);\n      },\n      tabIndex: \"0\",\n      onKeyPress: e => {\n        if (e.key === ' ' || e.key === \"Enter\") {\n          props.onCharSelected(id);\n          focusOnItem(i);\n        }\n      },\n      children: [/*#__PURE__*/_jsxDEV(ImgObjFit, {\n        char: item,\n        alt: name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"char__name\",\n        children: name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 21\n      }, this)]\n    }, id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 17\n    }, this);\n  });\n};\n\n_s2(Items, \"RzXtI9YS9F77oAUMehZXMa1xtz0=\");\n\n_c2 = Items;\nexport default CharList;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CharList\");\n$RefreshReg$(_c2, \"Items\");","map":{"version":3,"sources":["C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/src/components/charList/CharList.js"],"names":["MarvelService","useState","useEffect","useRef","Spinner","ErrorMessage","ImgObjFit","CharList","charList","setCharList","loading","setLoading","error","setError","newItemLoading","setNewItemLoading","offset","setOffset","charEnded","setCharEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","newCharList","ended","length","charlist","spinner","errorMessage","content","props","onCharSelected","Items","id","setId","selected","setSelect","isFocused","setFocus","onItemSelected","elem","setState","itemRefs","focusOnItem","console","log","current","forEach","item","classList","remove","add","focus","map","i","name","classNames","state","el","e","key"],"mappings":"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","sourcesContent":["import MarvelService from '../../services/MarvelService';\r\nimport { useState, useEffect, useRef } from 'react';\r\n\r\nimport Spinner from '../spinner/Spinner';\r\nimport ErrorMessage from '../errorMessage/ErrorMessage';\r\nimport ImgObjFit from '../blocks/imgObjectFit';\r\nimport './charList.scss';\r\n\r\n\r\nconst CharList = () => {\r\n\r\n    const [charList, setCharList] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(false);\r\n    const [newItemLoading, setNewItemLoading] = useState(false);\r\n    const [offset, setOffset] = useState(1541);\r\n    const [charEnded, setCharEnded] = useState(false);\r\n\r\n    const marvelService = new MarvelService();\r\n\r\n    useEffect(() => {\r\n        onRequest();\r\n    },[])\r\n\r\n\r\n    const onRequest = (offset) => {\r\n        onCharListLoading();\r\n        marvelService.getAllCharacters(offset)\r\n            .then(onCharListLoaded)\r\n            .catch(onError);\r\n    }\r\n\r\n    const onCharListLoading = () => {\r\n       setNewItemLoading(true);\r\n    }\r\n\r\n    const onCharListLoaded = (newCharList) => {\r\n        let ended = false;\r\n        if (newCharList.length < 9) {\r\n            ended = true\r\n        }\r\n\r\n        setCharList(charlist => [...charList, ...newCharList]);\r\n        setLoading(loading => false);\r\n        setNewItemLoading(newItemLoading => false);\r\n        setOffset(offset => offset + 9);\r\n        setCharEnded(charEnded => ended);\r\n    }\r\n        \r\n    const onError = () => {\r\n        setError(true);\r\n        setLoading(loading => false);\r\n    }\r\n   \r\n\r\n    const spinner = loading ? <Spinner/> : null;\r\n    const errorMessage = error ? <ErrorMessage/> : null;\r\n    const content = !(loading || error) ? <Items onCharSelected={props.onCharSelected} charlist={charList}/> : null;\r\n\r\n    return (\r\n        <div className=\"char__list\">\r\n            <ul className=\"char__grid\">\r\n                {errorMessage}\r\n                {spinner}\r\n                {content}\r\n            </ul>\r\n            <button \r\n                className=\"button button__main button__long\"\r\n                onClick={() => this.onRequest(offset)}\r\n                disabled={newItemLoading}\r\n                style={{'display': charEnded ? 'none' : 'block'}}>\r\n                <div className=\"inner\">load more</div>\r\n            </button>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Items = (props) => {\r\n\r\n    const [id, setId] = useState(null);\r\n    const [selected, setSelect] = useState(false);\r\n    const [isFocused, setFocus] = useState(false);\r\n\r\n\r\n    const onItemSelected = (id, elem) => {\r\n        this.setState({\r\n            selected: true,\r\n            isFocused: true,\r\n            id: id\r\n        })\r\n        setId(id);\r\n        setSelect(true);\r\n        setFocus(true);\r\n    }\r\n\r\n    const itemRefs = useRef([]);\r\n\r\n     \r\n\r\n    const focusOnItem = (id) => {\r\n        console.log(id, 'focus');\r\n        itemRefs.current.forEach(item => item.classList.remove('char__item_selected'));\r\n        itemRefs.current[id].classList.add('char__item_selected');\r\n        itemRefs.current[id].focus();\r\n    }\r\n\r\n        // const {charlist, onCharSelected} = this.props;\r\n\r\n    return (\r\n        charlist.map((item, i) => {\r\n            const {id, name} = item;\r\n\r\n            let classNames = 'char__item';\r\n            if (id === this.state.id && this.state.isFocused) {\r\n                classNames += ' char__item_selected';\r\n            }\r\n            \r\n            return (\r\n                <li className={classNames}\r\n                    key={id}\r\n                    ref={el => itemRefs.current[i] = el}\r\n                    onClick={() => {\r\n                        onCharSelected(id);\r\n                        this.onItemSelected(id);\r\n                    }}\r\n                    tabIndex='0'\r\n                    onKeyPress={(e) => { \r\n                        if (e.key === ' ' || e.key === \"Enter\") {\r\n                            props.onCharSelected(id);\r\n                            focusOnItem(i);\r\n                        }}}>\r\n                    <ImgObjFit char={item} alt={name}/>\r\n                    <div className=\"char__name\">{name}</div>\r\n                </li>\r\n            )\r\n        })\r\n    )\r\n}\r\n\r\nexport default CharList;"]},"metadata":{},"sourceType":"module"}