{"ast":null,"code":"import _toConsumableArray from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import MarvelService from'../../services/MarvelService';import{useState,useEffect,useRef}from'react';import Spinner from'../spinner/Spinner';import ErrorMessage from'../errorMessage/ErrorMessage';import ImgObjFit from'../blocks/imgObjectFit';import'./charList.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CharList=function CharList(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),charList=_useState2[0],setCharList=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),newItemLoading=_useState8[0],setNewItemLoading=_useState8[1];var _useState9=useState(1541),_useState10=_slicedToArray(_useState9,2),offset=_useState10[0],setOffset=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),charEnded=_useState12[0],setCharEnded=_useState12[1];var marvelService=new MarvelService();useEffect(function(){onRequest();},[]);var onRequest=function onRequest(offset){onCharListLoading();marvelService.getAllCharacters(offset).then(onCharListLoaded).catch(onError);};var onCharListLoading=function onCharListLoading(){setNewItemLoading(true);};var onCharListLoaded=function onCharListLoaded(newCharList){var ended=false;if(newCharList.length<9){ended=true;}setCharList(function(charlist){return[].concat(_toConsumableArray(charList),_toConsumableArray(newCharList));});setLoading(function(loading){return false;});setNewItemLoading(function(newItemLoading){return false;});setOffset(function(offset){return offset+9;});setCharEnded(function(charEnded){return ended;});};var onError=function onError(){setError(true);setLoading(function(loading){return false;});};var spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;var errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;var content=!(loading||error)?/*#__PURE__*/_jsx(Items,{onCharSelected:props.onCharSelected,charlist:charList}):null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[/*#__PURE__*/_jsxs(\"ul\",{className:\"char__grid\",children:[errorMessage,spinner,content]}),/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",onClick:function onClick(){return onRequest(offset);},disabled:newItemLoading,style:{'display':charEnded?'none':'block'},children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});};var Items=function Items(props){var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),charId=_useState14[0],setCharId=_useState14[1];// const [selected, setSelect] = useState(false);\nvar _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isFocused=_useState16[0],setFocus=_useState16[1];var onItemSelected=function onItemSelected(id,elem){setCharId(id);// setSelect(true);\nsetFocus(true);};var itemRefs=useRef([]);var focusOnItem=function focusOnItem(id){itemRefs.current.forEach(function(item){return item.classList.remove('char__item_selected');});itemRefs.current[id].classList.add('char__item_selected');itemRefs.current[id].focus();};return props.charlist.map(function(item,i){var id=item.id,name=item.name;var classNames='char__item';if(id===charId&&isFocused){classNames+=' char__item_selected';}return/*#__PURE__*/_jsxs(\"li\",{className:classNames,ref:function ref(el){return itemRefs.current[i]=el;},onClick:function onClick(){props.onCharSelected(id);onItemSelected(id);},tabIndex:\"0\",onKeyPress:function onKeyPress(e){if(e.key===' '||e.key===\"Enter\"){props.onCharSelected(id);focusOnItem(i);}},children:[/*#__PURE__*/_jsx(ImgObjFit,{char:item,alt:name}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:name})]},id);});};export default CharList;","map":{"version":3,"sources":["C:/DiskA/Frontend/Udemy2021Tasks/Projects/React/marvel/marvel-app/src/components/charList/CharList.js"],"names":["MarvelService","useState","useEffect","useRef","Spinner","ErrorMessage","ImgObjFit","CharList","props","charList","setCharList","loading","setLoading","error","setError","newItemLoading","setNewItemLoading","offset","setOffset","charEnded","setCharEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","newCharList","ended","length","charlist","spinner","errorMessage","content","onCharSelected","Items","charId","setCharId","isFocused","setFocus","onItemSelected","id","elem","itemRefs","focusOnItem","current","forEach","item","classList","remove","add","focus","map","i","name","classNames","el","e","key"],"mappings":"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","sourcesContent":["import MarvelService from '../../services/MarvelService';\r\nimport { useState, useEffect, useRef } from 'react';\r\n\r\nimport Spinner from '../spinner/Spinner';\r\nimport ErrorMessage from '../errorMessage/ErrorMessage';\r\nimport ImgObjFit from '../blocks/imgObjectFit';\r\nimport './charList.scss';\r\nimport propTypes from 'prop-types';\r\n\r\n\r\nconst CharList = (props) => {\r\n\r\n    const [charList, setCharList] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(false);\r\n    const [newItemLoading, setNewItemLoading] = useState(false);\r\n    const [offset, setOffset] = useState(1541);\r\n    const [charEnded, setCharEnded] = useState(false);\r\n\r\n    const marvelService = new MarvelService();\r\n\r\n    useEffect(() => {\r\n        onRequest();\r\n    },[])\r\n\r\n    const onRequest = (offset) => {\r\n        onCharListLoading();\r\n        marvelService.getAllCharacters(offset)\r\n            .then(onCharListLoaded)\r\n            .catch(onError);\r\n    }\r\n\r\n    const onCharListLoading = () => {\r\n       setNewItemLoading(true);\r\n    }\r\n\r\n    const onCharListLoaded = (newCharList) => {\r\n        let ended = false;\r\n        if (newCharList.length < 9) {\r\n            ended = true\r\n        }\r\n\r\n        setCharList(charlist => [...charList, ...newCharList]);\r\n        setLoading(loading => false);\r\n        setNewItemLoading(newItemLoading => false);\r\n        setOffset(offset => offset + 9);\r\n        setCharEnded(charEnded => ended);\r\n    }\r\n        \r\n    const onError = () => {\r\n        setError(true);\r\n        setLoading(loading => false);\r\n    }\r\n\r\n    const spinner = loading ? <Spinner/> : null;\r\n    const errorMessage = error ? <ErrorMessage/> : null;\r\n    const content = !(loading || error) ? <Items onCharSelected={props.onCharSelected} charlist={charList}/> : null;\r\n\r\n    return (\r\n        <div className=\"char__list\">\r\n            <ul className=\"char__grid\">\r\n                {errorMessage}\r\n                {spinner}\r\n                {content}\r\n            </ul>\r\n            <button \r\n                className=\"button button__main button__long\"\r\n                onClick={() => onRequest(offset)}\r\n                disabled={newItemLoading}\r\n                style={{'display': charEnded ? 'none' : 'block'}}>\r\n                <div className=\"inner\">load more</div>\r\n            </button>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Items = (props) => {\r\n\r\n    const [charId, setCharId] = useState(null);\r\n    // const [selected, setSelect] = useState(false);\r\n    const [isFocused, setFocus] = useState(false);\r\n\r\n    const onItemSelected = (id, elem) => {\r\n        setCharId(id);\r\n        // setSelect(true);\r\n        setFocus(true);\r\n    }\r\n\r\n    const itemRefs = useRef([]);\r\n\r\n    const focusOnItem = (id) => {\r\n        itemRefs.current.forEach(item => item.classList.remove('char__item_selected'));\r\n        itemRefs.current[id].classList.add('char__item_selected');\r\n        itemRefs.current[id].focus();\r\n    }\r\n\r\n    return (\r\n        props.charlist.map((item, i) => {\r\n            const {id, name} = item;\r\n\r\n            let classNames = 'char__item';\r\n            if (id === charId && isFocused) {\r\n                classNames += ' char__item_selected';\r\n            }\r\n            \r\n            return (\r\n                <li className={classNames}\r\n                    key={id}\r\n                    ref={el => itemRefs.current[i] = el}\r\n                    onClick={() => {\r\n                        props.onCharSelected(id);\r\n                        onItemSelected(id);\r\n                    }}\r\n                    tabIndex='0'\r\n                    onKeyPress={(e) => { \r\n                        if (e.key === ' ' || e.key === \"Enter\") {\r\n                            props.onCharSelected(id);\r\n                            focusOnItem(i);\r\n                        }}}>\r\n                    <ImgObjFit char={item} alt={name}/>\r\n                    <div className=\"char__name\">{name}</div>\r\n                </li>\r\n            )\r\n        })\r\n    )\r\n}\r\n\r\nCharList.propTypes = {\r\n    onCharSelected: propTypes.func.isRequired\r\n}\r\n\r\nexport default CharList;"]},"metadata":{},"sourceType":"module"}